<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>네이버 지도: 마커 + 주소 저장 + 반경</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=s3f4t4mo6d"></script>
  <style>
    #map {
      width: 100%;
      height: 600px;
    }
    #info {
      margin-top: 10px;
      padding: 10px;
      background: #f8f8f8;
      border: 1px solid #ccc;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h2>🗺️ 지도 클릭 → 마커 생성 + 주소 저장 + 반경 표시</h2>
  <div id="map"></div>
  <div id="info">📌 클릭한 위치 정보가 여기에 표시됩니다.</div>

  <script>
    window.onload = function () {
      const map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.5665, 126.9780),
        zoom: 13
      });

      const savedLocations = [];

      // 클릭 이벤트
      naver.maps.Event.addListener(map, 'click', function (e) {
        const lat = e.coord.lat();
        const lng = e.coord.lng();

        const marker = new naver.maps.Marker({
          position: e.coord,
          map: map
        });

        const circle = new naver.maps.Circle({
          map: map,
          center: e.coord,
          radius: 500,
          strokeColor: '#007AFF',
          strokeOpacity: 0.7,
          strokeWeight: 2,
          fillColor: '#cce6ff',
          fillOpacity: 0.3
        });

        naver.maps.Service.reverseGeocode({
          coords: e.coord,
          orders: naver.maps.Service.OrderType.ADDR
        }, function (status, response) {
          if (status !== naver.maps.Service.Status.OK) {
            alert('주소를 찾을 수 없습니다.');
            return;
          }

          const result = response.v2.address;
          const address = result.jibunAddress || result.roadAddress || '주소 없음';

          savedLocations.push({
            lat: lat,
            lng: lng,
            address: address
          });

          document.getElementById('info').innerHTML = `
            🧭 위도: ${lat.toFixed(6)}<br>
            📍 경도: ${lng.toFixed(6)}<br>
            🏠 주소: ${address}<br>
            💾 저장된 지점 수: ${savedLocations.length}
          `;
          console.log('저장된 위치 목록:', savedLocations);
        });
      });

      // 지도 리프레시 (지연 후 실행)
      setTimeout(function () {
        map.refresh();
      }, 1000);
    };
  </script>
</body>
</html>
