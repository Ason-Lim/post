<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NCP Maps API Integrated Example</title>
  <!-- Naver Maps JavaScript API v3 (Dynamic Map) with Geocoder submodule.
       Note: Replace YOUR_CLIENT_ID with your actual ncpClientId. -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=5jzdmh3hqy"></script>
  <!--:contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}-->
</head>
<body>
  <!-- Static Map Example: Displays a static map image of Seoul City Hall area.
       The static map is 300x300px, centered at Seoul City Hall (lat 37.5665, lon 126.9780),
       with a marker labeled "A" at that location. 
       The 'X-NCP-APIGW-API-KEY-ID' query parameter uses the same client ID (YOUR_CLIENT_ID). -->
  <h3>Static Map Example (Seoul City Hall)</h3>
  <img id="staticMap" 
       src="https://naveropenapi.apigw.ntruss.com/map-static/v2/raster-cors?w=300&h=300&center=126.9780,37.5665&level=16&markers=type:t|size:mid|pos:126.9780 37.5665|label:A&X-NCP-APIGW-API-KEY-ID=5jzdmh3hqy" 
       alt="Static map of Seoul City Hall" width="300" height="300" /> <!--:contentReference[oaicite:2]{index=2}-->

  <!-- Address search input and button -->
  <p>
    <strong>주소 검색:</strong> 
    <input type="text" id="addressInput" placeholder="Enter an address" size="30" />
    <button id="searchBtn">Search</button>
  </p>

  <!-- Dynamic map container (full width, 400px height) -->
  <div id="map" style="width:100%; height:400px; border:1px solid #ccc;"></div>

  <script>
    // Ensure the Naver Maps API script loaded successfully before using it.
    if (typeof naver === 'undefined' || !naver.maps) {
      console.error("Naver Maps API failed to load. Check your ncpClientId or network connection."); 
      alert("Map API authentication failed. Please check your API key (ncpClientId).");
    } else {
      try {
        // 1. Initialize the dynamic map centered on Seoul City Hall (lat 37.5665, lon 126.9780).
        var mapOptions = {
          center: new naver.maps.LatLng(37.5665, 126.9780), // Seoul City Hall coordinates:contentReference[oaicite:3]{index=3}
          zoom: 14  // Zoom level (14 gives a city-level view)
        };
        var map = new naver.maps.Map('map', mapOptions);
        
        // 2. Place an initial marker at the map center (Seoul City Hall).
        var initialMarker = new naver.maps.Marker({
          position: new naver.maps.LatLng(37.5665, 126.9780),
          map: map
        }); // The marker appears at the center coordinates:contentReference[oaicite:4]{index=4}

        // 3. Add an event listener to the map for clicks.
        //    On each map click, add a new marker at that location and draw a 500m radius circle.
        naver.maps.Event.addListener(map, 'click', function(e) {
          var clickLatLng = e.latlng;  // Get coordinates of the click event:contentReference[oaicite:5]{index=5}
          // Add a marker at the clicked location
          new naver.maps.Marker({
            position: clickLatLng,
            map: map
          });
          // Draw a 500m radius circle centered at the clicked location
          new naver.maps.Circle({
            map: map,
            center: clickLatLng,
            radius: 500,               // 500 meters radius
            strokeColor: "#0077FF",    // Circle border color (blue)
            strokeWeight: 2, 
            strokeOpacity: 0.8,
            fillColor: "#87CEFA",      // Fill color (skyblue)
            fillOpacity: 0.3
          });
        });

        // 4. Set up the address search functionality using Naver Maps Geocoder.
        var addressInput = document.getElementById('addressInput');
        var searchBtn = document.getElementById('searchBtn');
        // When the Search button is clicked, geocode the address.
        searchBtn.addEventListener('click', function() {
          var query = addressInput.value.trim();
          if (!query) {
            alert("주소를 입력해주세요."); 
            return;
          }
          // Use Naver Maps Geocoder service to convert address to coordinates
          naver.maps.Service.geocode({ address: query }, function(status, response) {
            if (status !== naver.maps.Service.Status.OK) {
              console.error("Geocoding Error: status=" + status);
              alert("주소 검색 결과가 없습니다. (Error: " + status + ")");
              return;
            }
            // If successful, the response.result.items array will contain at least one result:contentReference[oaicite:6]{index=6}:contentReference[oaicite:7]{index=7}
            var result = response.result;
            if (result.total === 0 || !result.items) {
              alert("주소 검색 결과가 없습니다.");
              return;
            }
            // Use the first result's coordinates
            var firstItem = result.items[0]; 
            var addrPoint = firstItem.point;
            var lat = parseFloat(addrPoint.y); // latitude
            var lng = parseFloat(addrPoint.x); // longitude
            // Move the map to the found coordinates and add a marker there
            var newCenter = new naver.maps.LatLng(lat, lng);
            map.setCenter(newCenter);
            new naver.maps.Marker({
              position: newCenter,
              map: map
            });
          });
        });
      } catch (e) {
        console.error("Error initializing Naver Map:", e);
        alert("지도 로딩 중 오류가 발생했습니다: " + e.message);
      }
    }
  </script>
</body>
</html>
